#ifndef BENCH
#undef _GLIBCXX_DEBUG
#pragma GCC optimize "Ofast,unroll-loops,omit-frame-pointer,inline"
#pragma GCC option("arch=native", "tune=native", "no-zero-upper")
#pragma GCC target("movbe,aes,pclmul,avx,avx2,f16c,fma,sse3,ssse3,sse4.1,sse4.2,rdrnd,popcnt,bmi,bmi2,lzcnt")
#endif
#include <bits/stdc++.h>

using namespace std;
using u64 = uint64_t;
using u32 = uint32_t;
using u16 = uint16_t;
using u8 = uint8_t;
const u32 legal[] ={1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,2,2,2,2,1,1,1,1,2,2,2,1,1,1,1,1,2,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,8,142,142,142,142,14,8,8,8,142,142,142,14,12,8,8,8,142,142,14,12,12,8,8,8,142,14,12,12,12,8,8,8,14,12,12,12,12,8,8,1,4,4,4,4,4,1,1,1,4,4,4,4,4,1,1,1,4,4,4,4,1,1,1,8,142,142,142,14,10,8,8,8,142,142,14,14,8,8,8,8,142,14,14,12,8,8,8,8,14,14,12,12,8,8,8,1,6,4,4,4,1,1,1,1,4,4,4,4,1,1,1,1,4,4,4,4,1,1,1,1,4,4,4,1,1,1,1,8,142,142,14,10,10,8,8,8,142,14,14,10,8,8,8,8,14,14,14,8,8,8,8,1,6,6,4,1,1,1,1,1,6,4,4,1,1,1,1,1,4,4,4,1,1,1,1,1,4,4,4,1,1,1,1,1,4,4,1,1,1,1,1,8,142,14,10,10,10,8,8,8,14,14,10,10,8,8,8,1,6,6,2,1,1,1,1,1,6,6,1,1,1,1,1,1,6,4,1,1,1,1,1,1,4,4,1,1,1,1,1,1,4,4,1,1,1,1,1,1,4,1,1,1,1,1,1,8,14,10,10,10,10,8,8,1,6,2,2,2,1,1,1,1,6,2,2,1,1,1,1,1,6,2,1,1,1,1,1,1,6,1,1,1,1,1,1,1,4,1,1,1,1,1,1,1,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,2,2,2,2,1,1,1,1,2,2,2,1,1,1,1,1,2,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,2,2,2,2,1,1,1,1,2,2,2,1,1,1,1,1,2,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,16,16,16,16,16,1,1,32,306,306,306,306,50,32,32,32,306,306,306,50,48,32,32,32,306,306,50,48,48,32,32,32,306,50,48,48,48,32,32,32,50,48,48,48,48,32,32,1,16,16,16,16,16,1,1,1,16,16,16,16,16,1,1,64,596,596,596,596,84,64,64,1128,4094,4094,4094,2046,1150,1128,1128,1128,4094,4094,2046,1662,1148,1128,1128,1128,4094,2046,1662,1660,1148,1128,1128,1128,2046,1662,1660,1660,1148,1128,1128,104,638,636,636,636,124,104,104,64,596,596,596,596,84,64,64,64,596,596,596,596,84,64,64,64,596,596,596,84,80,64,64,1128,4094,4094,2046,1406,1146,1128,1128,1128,4094,2046,1918,1150,1144,1128,1128,1128,2046,1918,1662,1148,1144,1128,1128,104,894,638,636,124,120,104,104,96,630,628,628,116,112,96,96,64,596,596,596,84,80,64,64,64,596,596,596,84,80,64,64,64,596,596,84,80,80,64,64,1128,4094,2046,1406,1402,1146,1128,1128,1128,2046,1918,1406,1146,1144,1128,1128,104,894,894,126,120,120,104,104,96,886,630,116,112,112,96,96,96,630,628,116,112,112,96,96,64,596,596,84,80,80,64,64,64,596,596,84,80,80,64,64,64,596,84,80,80,80,64,64,1128,2046,1406,1402,1402,1146,1128,1128,104,894,382,378,122,120,104,104,96,886,374,114,112,112,96,96,96,886,118,112,112,112,96,96,96,630,116,112,112,112,96,96,64,596,84,80,80,80,64,64,64,596,84,80,80,80,64,64,64,84,80,80,80,80,64,64,104,382,378,378,378,122,104,104,96,374,370,370,114,112,96,96,96,374,370,114,112,112,96,96,96,374,114,112,112,112,96,96,96,118,112,112,112,112,96,96,64,84,80,80,80,80,64,64,64,84,80,80,80,80,64,64,1,16,16,16,16,16,1,1,32,306,306,306,306,50,32,32,32,306,306,306,50,48,32,32,32,306,306,50,48,48,32,32,32,306,50,48,48,48,32,32,32,50,48,48,48,48,32,32,1,16,16,16,16,16,1,1,1,16,16,16,16,16,1,1,1,16,16,16,16,16,1,1,32,306,306,306,306,50,32,32,32,306,306,306,50,48,32,32,32,306,306,50,48,48,32,32,32,306,50,48,48,48,32,32,32,50,48,48,48,48,32,32,1,16,16,16,16,16,1,1,1,16,16,16,16,16,1,1,1,16,16,16,16,1,1,1,32,306,306,306,50,34,32,32,32,306,306,50,50,32,32,32,32,306,50,50,48,32,32,32,32,50,50,48,48,32,32,32,1,18,16,16,16,1,1,1,1,16,16,16,16,1,1,1,1,16,16,16,16,1,1,1,64,596,596,596,84,68,64,64,1128,4094,4094,2046,1278,1134,1128,1128,1128,4094,2046,1790,1150,1132,1128,1128,1128,2046,1790,1662,1148,1132,1128,1128,104,766,638,636,124,108,104,104,72,606,604,604,92,76,72,72,64,596,596,596,84,68,64,64,64,596,596,596,84,68,64,64,64,596,596,84,84,64,64,64,1128,4094,2046,1534,1150,1130,1128,1128,1128,2046,2046,1150,1150,1128,1128,1128,104,1022,638,126,124,104,104,104,104,638,638,124,124,104,104,104,64,598,596,84,84,64,64,64,64,596,596,84,84,64,64,64,64,596,596,84,84,64,64,64,64,596,84,84,80,64,64,64,1128,2046,1534,1406,1146,1130,1128,1128,104,1022,382,126,122,104,104,104,104,894,126,126,120,104,104,104,96,630,118,116,112,96,96,96,64,598,84,84,80,64,64,64,64,596,84,84,80,64,64,64,64,596,84,84,80,64,64,64,64,84,84,80,80,64,64,64,104,510,382,378,122,106,104,104,104,382,382,122,122,104,104,104,96,374,118,114,112,96,96,96,96,118,118,112,112,96,96,96,64,86,84,80,80,64,64,64,64,84,84,80,80,64,64,64,64,84,84,80,80,64,64,64,1,20,16,16,16,1,1,1,40,318,314,314,58,42,40,40,32,310,306,50,50,32,32,32,32,310,50,50,48,32,32,32,32,54,50,48,48,32,32,32,1,22,16,16,16,1,1,1,1,20,16,16,16,1,1,1,1,20,16,16,16,1,1,1,1,16,16,16,16,1,1,1,32,306,306,306,50,34,32,32,32,306,306,50,50,32,32,32,32,306,50,50,48,32,32,32,32,50,50,48,48,32,32,32,1,18,16,16,16,1,1,1,1,16,16,16,16,1,1,1,1,16,16,16,16,1,1,1,1,16,16,16,16,1,1,1,32,306,306,306,50,34,32,32,32,306,306,50,50,32,32,32,32,306,50,50,48,32,32,32,32,50,50,48,48,32,32,32,1,18,16,16,16,1,1,1,1,16,16,16,16,1,1,1,1,16,16,16,16,1,1,1,1,16,16,16,1,1,1,1,32,306,306,50,34,34,32,32,32,306,50,50,34,32,32,32,32,50,50,50,32,32,32,32,1,18,18,16,1,1,1,1,1,18,16,16,1,1,1,1,1,16,16,16,1,1,1,1,1,16,16,16,1,1,1,1,64,596,596,84,68,68,64,64,1128,4094,2046,1278,1262,1134,1128,1128,1128,2046,1790,1278,1134,1132,1128,1128,104,766,766,126,108,108,104,104,72,734,606,92,76,76,72,72,72,606,604,92,76,76,72,72,64,596,596,84,68,68,64,64,64,596,596,84,68,68,64,64,64,596,84,84,68,64,64,64,1128,2046,1534,1278,1134,1130,1128,1128,104,1022,254,126,110,104,104,104,104,766,126,126,108,104,104,104,72,606,94,92,76,72,72,72,64,598,84,84,68,64,64,64,64,596,84,84,68,64,64,64,64,596,84,84,68,64,64,64,64,84,84,84,64,64,64,64,104,510,510,126,106,106,104,104,104,510,126,126,106,104,104,104,104,126,126,126,104,104,104,104,64,86,86,84,64,64,64,64,64,86,84,84,64,64,64,64,64,84,84,84,64,64,64,64,64,84,84,84,64,64,64,64,1,20,20,16,1,1,1,1,40,446,318,58,42,42,40,40,40,318,62,58,42,40,40,40,32,54,54,50,32,32,32,32,1,22,22,16,1,1,1,1,1,22,20,16,1,1,1,1,1,20,20,16,1,1,1,1,1,20,20,16,1,1,1,1,1,20,16,16,1,1,1,1,40,318,314,58,42,42,40,40,32,310,50,50,34,32,32,32,32,54,50,50,32,32,32,32,1,22,18,16,1,1,1,1,1,22,16,16,1,1,1,1,1,20,16,16,1,1,1,1,1,20,16,16,1,1,1,1,1,16,16,16,1,1,1,1,32,306,306,50,34,34,32,32,32,306,50,50,34,32,32,32,32,50,50,50,32,32,32,32,1,18,18,16,1,1,1,1,1,18,16,16,1,1,1,1,1,16,16,16,1,1,1,1,1,16,16,16,1,1,1,1,1,16,16,16,1,1,1,1,32,306,306,50,34,34,32,32,32,306,50,50,34,32,32,32,32,50,50,50,32,32,32,32,1,18,18,16,1,1,1,1,1,18,16,16,1,1,1,1,1,16,16,16,1,1,1,1,1,16,16,16,1,1,1,1,1,16,16,1,1,1,1,1,32,306,50,34,34,34,32,32,32,50,50,34,34,32,32,32,1,18,18,2,1,1,1,1,1,18,18,1,1,1,1,1,1,18,16,1,1,1,1,1,1,16,16,1,1,1,1,1,1,16,16,1,1,1,1,1,64,596,84,68,68,68,64,64,1128,2046,1278,1262,1262,1134,1128,1128,104,766,254,238,110,108,104,104,72,734,222,78,76,76,72,72,72,734,94,76,76,76,72,72,72,606,92,76,76,76,72,72,64,596,84,68,68,68,64,64,64,596,84,68,68,68,64,64,64,84,84,68,68,64,64,64,104,510,254,238,110,106,104,104,104,254,254,110,110,104,104,104,72,222,94,78,76,72,72,72,72,94,94,76,76,72,72,72,64,86,84,68,68,64,64,64,64,84,84,68,68,64,64,64,64,84,84,68,68,64,64,64,1,20,20,4,1,1,1,1,40,446,190,46,42,42,40,40,40,190,62,46,42,40,40,40,8,30,30,14,8,8,8,8,1,22,22,4,1,1,1,1,1,22,20,4,1,1,1,1,1,20,20,4,1,1,1,1,1,20,20,4,1,1,1,1,1,20,20,1,1,1,1,1,40,446,62,42,42,42,40,40,40,62,62,42,42,40,40,40,1,22,22,2,1,1,1,1,1,22,22,1,1,1,1,1,1,22,20,1,1,1,1,1,1,20,20,1,1,1,1,1,1,20,20,1,1,1,1,1,1,20,16,1,1,1,1,1,40,318,58,42,42,42,40,40,32,54,50,34,34,32,32,32,1,22,18,2,1,1,1,1,1,22,18,1,1,1,1,1,1,22,16,1,1,1,1,1,1,20,16,1,1,1,1,1,1,20,16,1,1,1,1,1,1,16,16,1,1,1,1,1,32,306,50,34,34,34,32,32,32,50,50,34,34,32,32,32,1,18,18,2,1,1,1,1,1,18,18,1,1,1,1,1,1,18,16,1,1,1,1,1,1,16,16,1,1,1,1,1,1,16,16,1,1,1,1,1,1,16,16,1,1,1,1,1,32,306,50,34,34,34,32,32,32,50,50,34,34,32,32,32,1,18,18,2,1,1,1,1,1,18,18,1,1,1,1,1,1,18,16,1,1,1,1,1,1,16,16,1,1,1,1,1,1,16,16,1,1,1,1,1,1,16,1,1,1,1,1,1,32,50,34,34,34,34,32,32,1,18,2,2,2,1,1,1,1,18,2,2,1,1,1,1,1,18,2,1,1,1,1,1,1,18,1,1,1,1,1,1,1,16,1,1,1,1,1,1,1,16,1,1,1,1,1,1,64,84,68,68,68,68,64,64,104,254,238,238,238,110,104,104,72,222,206,206,78,76,72,72,72,222,206,78,76,76,72,72,72,222,78,76,76,76,72,72,72,94,76,76,76,76,72,72,64,84,68,68,68,68,64,64,64,84,68,68,68,68,64,64,1,20,4,4,4,1,1,1,40,190,174,174,46,42,40,40,8,158,142,14,14,8,8,8,8,158,14,14,12,8,8,8,8,30,14,12,12,8,8,8,1,22,4,4,4,1,1,1,1,20,4,4,4,1,1,1,1,20,4,4,4,1,1,1,1,20,4,4,1,1,1,1,40,190,174,46,42,42,40,40,8,158,14,14,10,8,8,8,8,30,14,14,8,8,8,8,1,22,6,4,1,1,1,1,1,22,4,4,1,1,1,1,1,20,4,4,1,1,1,1,1,20,4,4,1,1,1,1,1,20,4,1,1,1,1,1,40,190,46,42,42,42,40,40,8,30,14,10,10,8,8,8,1,22,6,2,1,1,1,1,1,22,6,1,1,1,1,1,1,22,4,1,1,1,1,1,1,20,4,1,1,1,1,1,1,20,4,1,1,1,1,1,1,20,1,1,1,1,1,1,40,62,42,42,42,42,40,40,1,22,2,2,2,1,1,1,1,22,2,2,1,1,1,1,1,22,2,1,1,1,1,1,1,22,1,1,1,1,1,1,1,20,1,1,1,1,1,1,1,20,1,1,1,1,1,1,1,16,1,1,1,1,1,1,32,50,34,34,34,34,32,32,1,18,2,2,2,1,1,1,1,18,2,2,1,1,1,1,1,18,2,1,1,1,1,1,1,18,1,1,1,1,1,1,1,16,1,1,1,1,1,1,1,16,1,1,1,1,1,1,1,16,1,1,1,1,1,1,32,50,34,34,34,34,32,32,1,18,2,2,2,1,1,1,1,18,2,2,1,1,1,1,1,18,2,1,1,1,1,1,1,18,1,1,1,1,1,1,1,16,1,1,1,1,1,1,1,16,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,2,2,2,2,1,1,1,1,2,2,2,1,1,1,1,1,2,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,8,142,142,142,142,14,8,8,8,142,142,142,14,12,8,8,8,142,142,14,12,12,8,8,8,142,14,12,12,12,8,8,8,14,12,12,12,12,8,8,1,4,4,4,4,4,1,1,1,4,4,4,4,4,1,1,1,4,4,4,4,1,1,1,8,142,142,142,14,10,8,8,8,142,142,14,14,8,8,8,8,142,14,14,12,8,8,8,8,14,14,12,12,8,8,8,1,6,4,4,4,1,1,1,1,4,4,4,4,1,1,1,1,4,4,4,4,1,1,1,1,4,4,4,1,1,1,1,8,142,142,14,10,10,8,8,8,142,14,14,10,8,8,8,8,14,14,14,8,8,8,8,1,6,6,4,1,1,1,1,1,6,4,4,1,1,1,1,1,4,4,4,1,1,1,1,1,4,4,4,1,1,1,1,1,4,4,1,1,1,1,1,8,142,14,10,10,10,8,8,8,14,14,10,10,8,8,8,1,6,6,2,1,1,1,1,1,6,6,1,1,1,1,1,1,6,4,1,1,1,1,1,1,4,4,1,1,1,1,1,1,4,4,1,1,1,1,1,1,4,1,1,1,1,1,1,8,14,10,10,10,10,8,8,1,6,2,2,2,1,1,1,1,6,2,2,1,1,1,1,1,6,2,1,1,1,1,1,1,6,1,1,1,1,1,1,1,4,1,1,1,1,1,1,1,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,2,2,2,2,1,1,1,1,2,2,2,1,1,1,1,1,2,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,2,2,2,2,1,1,1,1,2,2,2,1,1,1,1,1,2,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,2,2,2,2,1,1,1,1,2,2,2,1,1,1,1,1,2,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,8,142,142,142,142,14,8,8,8,142,142,142,14,12,8,8,8,142,142,14,12,12,8,8,8,142,14,12,12,12,8,8,8,14,12,12,12,12,8,8,1,4,4,4,4,4,1,1,1,4,4,4,4,4,1,1,1,4,4,4,4,1,1,1,8,142,142,142,14,10,8,8,8,142,142,14,14,8,8,8,8,142,14,14,12,8,8,8,8,14,14,12,12,8,8,8,1,6,4,4,4,1,1,1,1,4,4,4,4,1,1,1,1,4,4,4,4,1,1,1,1,4,4,4,1,1,1,1,8,142,142,14,10,10,8,8,8,142,14,14,10,8,8,8,8,14,14,14,8,8,8,8,1,6,6,4,1,1,1,1,1,6,4,4,1,1,1,1,1,4,4,4,1,1,1,1,1,4,4,4,1,1,1,1,1,4,4,1,1,1,1,1,8,142,14,10,10,10,8,8,8,14,14,10,10,8,8,8,1,6,6,2,1,1,1,1,1,6,6,1,1,1,1,1,1,6,4,1,1,1,1,1,1,4,4,1,1,1,1,1,1,4,4,1,1,1,1,1,1,4,1,1,1,1,1,1,8,14,10,10,10,10,8,8,1,6,2,2,2,1,1,1,1,6,2,2,1,1,1,1,1,6,2,1,1,1,1,1,1,6,1,1,1,1,1,1,1,4,1,1,1,1,1,1,1,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,2,2,2,2,1,1,1,1,2,2,2,1,1,1,1,1,2,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,2,2,2,2,1,1,1,1,2,2,2,1,1,1,1,1,2,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1};
const int perm[8][9] = {
	{0,1,2,3,4,5,6,7,8},
	{6,3,0,7,4,1,8,5,2}, //r
	{8,7,6,5,4,3,2,1,0},
	{2,5,8,1,4,7,0,3,6},
	{2,1,0,5,4,3,8,7,6}, //s
	{0,3,6,1,4,7,2,5,8}, //sr
	{6,7,8,3,4,5,0,1,2},
	{8,5,2,7,4,1,6,3,0},
};
const int compo[8][8] = {
	{0,1,2,3,4,5,6,7},
	{1,2,3,0,7,4,5,6},
	{2,3,0,1,6,7,4,5},
	{3,0,1,2,5,6,7,4},
	{4,5,6,7,0,1,2,3},
	{5,6,7,4,3,0,1,2},
	{6,7,4,5,2,3,0,1},
	{7,4,5,6,1,2,3,0}
};
const u64 U = 0'070'000'000ULL << (3*4);
const u64 L = 0'000'700'000ULL << (3*4);
const u64 C = 0'000'070'000ULL << (3*4);
const u64 R = 0'000'007'000ULL << (3*4);
const u64 D = 0'000'000'070ULL << (3*4);
constexpr u64 capMask[12] = {0, R|D, L|D, L|R, U|D, U|R, U|L, L|R|D, U|R|D, U|L|D, U|L|R, U|L|R|D};
constexpr u32 M30 = 0x3fffffff;
constexpr u32 P10[9] = {100'000'000, 10'000'000, 1'000'000, 100'000, 10'000, 1'000, 100, 10, 1};

using State = u32;
const u32 HASHMAX = (1<<16);

struct Hashmap {
	u32 *val;
	const size_t maxSize = HASHMAX;

	Hashmap() {
		val = new u32[maxSize*9];
	}

	u32* find(u32 s) {
		//u16 hash = (s * 0x80008001) >> 16;
		//u16 hash = (s * 2654435761) >> 11;
		u32 x = s;
		x^=(x>>13), x^=(x<<7), x^=(x>>17);
		u16 hash = x;
		while (val[hash*9] && val[hash*9] != s) {
			hash++;
		}
		val[hash*9] = s;
		return &(val[hash*9+1]);
	}

	void clear() {
		//cerr << "order is : " << order << "\n";
		//cerr << size << " entries : " << ((100.0)*size)/(1<<order) << "%\n";
			//cerr << "growing\n";
		memset(val, 0, 9*maxSize*sizeof(u32));
	}
};

Hashmap memo[2];

constexpr u32 output(u32 val[9]) {
	u32 res = 0;
	for (int i = 0; i < 9; i++) {
		res += val[i]*P10[i];
	}
	return res&M30;
}

constexpr u32 posShift(u8 val, u8 pos) {
	u32 res = val;
	return res << (3*pos);
}

constexpr int at(State s, u8 pos) {
	return (s>>(3*pos))&7;
}

constexpr void addToRes(u32 res[9], State s, u32 cnt[8]) {
	for (int pos = 0; pos < 9; pos++)
		for (int per = 0; per < 8; per++)
			res[perm[per][pos]] += at(s,pos) * cnt[per];
}

constexpr u16 neigh(u32 g, u8 pos) {
	constexpr u16 oobMask[9] = {077, 07, 0707, 070, 0, 0700, 07070, 07000, 07700};
	u64 hood = g;
	hood <<= 3*(8-pos); 
	hood = ((hood&U)>>(3*8)) | ((hood&L)>>(3*7)) | ((hood&R)>>(3*6)) | ((hood&D)>>(3*5));
	return hood | oobMask[pos];
} 

constexpr State nextS(State s, u8 pos, u8 capt) {
	u32 m = capMask[capt]>>(3*(8-pos));

	u32 val = s&m;
	val = val*0111111111;
	val = (val>>(3*8))&7;
	val += capt==0;

	return (s&~m) | posShift(val, pos);
}

constexpr pair<u32, u8> canon(State s) {
	u32 can = s;
	u32 per = 0;
	for (int p = 1; p < 8; p++) {
		u32 alt = 0;
		for (int i = 0; i < 9; i++) {
			alt |= posShift(at(s, perm[p][i]), i);
		}
		if (alt < can) {
			can = alt;
			per = p;
		}
	}
	return {can, per};
}

void insert(bool sub_idx, State s, u32 cnt[8]) {
	pair<u32, u8> p = canon(s);
	u32* entry = memo[sub_idx].find(p.first);
	for (int i = 0; i < 8; i++) {
		entry[compo[p.second][i]] += cnt[i];
	}

}

int parse() {
	int depth;
	cin >> depth; cin.ignore();
	u32 s = 0;
	for (int i = 0; i < 9; i++) {
		u32 val;
		cin >> val; cin.ignore();
		s = s | (val<<(3*i));
	}
	u32 cnt[9] = {1,0,0,0,0,0,0,0,0};
	for (u8 pos = 0; pos < 9; pos++) {
		if (at(s,pos))
			continue;
		u16 capMask = legal[neigh(s, pos)];
		for (int capt = 0; capt < 12; capt++) {
			if (!(capMask & (1<<capt)))
				continue;
			State next = nextS(s, pos, capt);
			insert(0, next, cnt);
		}
	}
	return depth;
}

u32 solve()
{
	int depth = parse();
	u32 res[9] = {0};
	bool sub_idx = 0;
	for (int d = depth-1; d > 0; d--, sub_idx ^= 1) {
		for (int i = 0; i < HASHMAX; i++) {
			if (!memo[sub_idx].val[i*9])
				continue;
			State s = memo[sub_idx].val[i*9];
			u32* cnt = &(memo[sub_idx].val[i*9+1]);
			bool final = true;
			for (u8 pos = 0; pos < 9; pos++) {
				if (at(s,pos))
					continue;
				u16 capMask = legal[neigh(s, pos)];
				for (int capt = 0; capt < 12; capt++) {
					if (!(capMask & (1<<capt)))
						continue;
					final = false;
					State next = nextS(s, pos, capt);
					insert(!sub_idx, next, cnt);
				}
			}
			if (final) {
				addToRes(res, s, cnt);
			}
		}
		memo[sub_idx].clear();
	}
	for (int i = 0; i < HASHMAX; i++) {
		if (!memo[sub_idx].val[i*9])
			continue;
		addToRes(res, memo[sub_idx].val[i*9], &(memo[sub_idx].val[i*9+1]));
	}

	return output(res);
}

int main()
{
	ios::sync_with_stdio(false);
	cin.tie(nullptr);

	cout << solve() << '\n';
}
